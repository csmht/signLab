# 实验教学系统全面测试文档

## 测试环境准备

### 前置条件
- 项目已启动并运行在 `http://localhost:8080`
- 数据库已连接并初始化
- 测试工具：Postman 或 Apifox
- 测试数据准备：Excel文件、测试账号

### 测试账号说明
- **管理员账号**：admin（需提前创建或通过导入）
- **教师账号**：00006140（工号）
- **学生账号**：2112503179（学号）

---

## 测试流程概览

### 测试顺序

```
1. 用户认证与基础数据导入
   └── 管理员导入用户和班级数据

2. 教师功能测试
   ├── 课程与实验管理
   ├── 班级管理
   ├── 签到管理
   ├── 作业批改
   └── 成绩管理

3. 学生功能测试
   ├── 班级绑定
   ├── 签到
   ├── 作业提交
   └── 成绩查询

4. 数据导出测试
   └── 成绩和考勤记录导出

5. 微信功能测试（可选）
   └── 微信绑定与登录
```

---

## 一、用户认证与基础数据导入

### 1.1 管理员登录

**接口**：`POST /api/auth/login`

**请求体**：
```json
{
  "username": "admin",
  "password": "你的管理员密码"
}
```

**预期结果**：
- 返回状态码：200
- 返回 JWT Token
- 返回用户信息（角色为 admin）

**保存 Token**：将返回的 `token` 保存到环境变量 `ADMIN_TOKEN`

---

### 1.2 导入教师和学生数据

**接口**：`POST /api/test/excel/import/users`

**请求头**：
```
Authorization: Bearer {{ADMIN_TOKEN}}
```

**请求类型**：`multipart/form-data`

**请求参数**：
- `file`: users.xls 或 users.xlsx（Excel文件）

**Excel文件格式**：

| 用户名 | 姓名 | 角色 | 院系 | 专业 |
|--------|------|------|------|------|
| 00006140 | 谢小柱 | teacher | 计算机学院 | 软件工程 |
| 00006366 | 庞玮 | teacher | 计算机学院 | 物理 |
| 2112503179 | 张三 | student | 计算机学院 | 计算机科学与技术 |
| 2112503180 | 李四 | student | 计算机学院 | 软件工程 |

**预期结果**：
- 返回状态码：200
- 显示导入成功数量、重复数量、失败数量

---

### 1.3 导入班级数据

**接口**：`POST /api/test/excel/import/classes`

**请求参数**：
- `file`: classes.xls 或 classes.xlsx

**Excel文件格式**：

| 班级编号 | 班级名称 | 人数 |
|----------|----------|------|
| 工程实践B01 | 工程实践B01班 | 41 |
| 工程实践B02 | 工程实践B02班 | 42 |

**预期结果**：
- 返回状态码：200
- 班级数据导入成功

---

## 二、教师功能测试

### 2.1 教师登录

**接口**：`POST /api/auth/login`

**请求体**：
```json
{
  "username": "00006140",
  "password": "syjx@6140"
}
```

**保存 Token**：将返回的 `token` 保存到环境变量 `TEACHER_TOKEN`

---

### 2.2 查询班级学生列表

**接口**：`GET /api/teacher/students`

**请求头**：
```
Authorization: Bearer {{TEACHER_TOKEN}}
```

**查询参数**（可选）：
- `classCode`: 班级编号（如：工程实践B01）
- `studentType`: 学生类型（normal-正常生，cross-跨班生）
- `classExperimentId`: 课程实验ID

**预期结果**：
- 返回学生列表
- 包含学生统计信息（总人数、班级人数、跨班人数、已签到人数、签到率）

---

### 2.3 查询跨班签到学生

**接口**：`GET /api/teacher/attendance/cross-class-attendees`

**请求参数**：
- `classExperimentId`: 课程实验ID

**预期结果**：
- 返回跨班签到的学生列表
- 包含学生信息、签到时间、所属班级等

---

### 2.4 查询课程作业列表

**接口**：`GET /api/teacher/assignments/course/{courseId}`

**路径参数**：
- `courseId`: 课程ID（如：CS101）

**查询参数**（可选）：
- `experimentId`: 实验ID
- `submissionStatus`: 提交状态（draft/submitted/graded）

**预期结果**：
- 返回该课程的所有作业提交记录
- 包含学生信息、文件信息、提交状态、分数等

---

### 2.5 批改作业

**接口**：`POST /api/teacher/assignments/{submissionId}/grade`

**路径参数**：
- `submissionId`: 作业ID

**请求体**：
```json
{
  "teacherComment": "实验报告完成得很好，数据详实，分析透彻！",
  "score": 95.5
}
```

**预期结果**：
- 返回状态码：200
- 作业状态更新为 "graded"
- 保存评语和分数

---

### 2.6 查询课程成绩列表

**接口**：`GET /api/teacher/grades/course/{courseId}`

**路径参数**：
- `courseId`: 课程ID

**查询参数**（可选）：
- `semester`: 学期（如：2024-2025春正）

**预期结果**：
- 返回该课程的所有学生成绩
- 包含学生信息、成绩、评语、审核状态等

---

### 2.7 创建/更新课程成绩

**接口**：`POST /api/teacher/grades`

**请求体**：
```json
{
  "courseId": "CS101",
  "studentUsername": "2112503179",
  "grade": "A",
  "gradeNumeric": 90,
  "gradeType": "letter",
  "teacherComment": "表现优秀",
  "semester": "2024-2025春正"
}
```

**预期结果**：
- 返回状态码：200
- 成绩保存成功

---

### 2.8 审核成绩

**接口**：`POST /api/teacher/grades/{gradeId}/approve`

**路径参数**：
- `gradeId`: 成绩ID

**预期结果**：
- 返回状态码：200
- 成绩审核状态更新为 "已审核"

---

### 2.9 导出课程成绩

**接口**：`GET /api/teacher/export/course-grades/{courseId}`

**路径参数**：
- `courseId`: 课程ID

**查询参数**（可选）：
- `semester`: 学期

**预期结果**：
- 返回 Excel 文件（course_grades_{courseId}.xlsx）
- 包含所有学生的成绩数据

---

### 2.10 导出考勤记录

**接口**：`GET /api/teacher/export/attendance-records/{courseId}`

**路径参数**：
- `courseId`: 课程ID

**查询参数**（可选）：
- `startDate`: 开始日期（如：2025-01-01）
- `endDate`: 结束日期（如：2025-12-31）

**预期结果**：
- 返回 Excel 文件（attendance_records_{courseId}.xlsx）
- 包含所有考勤记录

---

## 三、学生功能测试

### 3.1 学生登录

**接口**：`POST /api/auth/login`

**请求体**：
```json
{
  "username": "2112503179",
  "password": "2112503179"
}
```

**保存 Token**：将返回的 `token` 保存到环境变量 `STUDENT_TOKEN`

---

### 3.2 绑定班级

**接口**：`POST /api/student/classes/bind-class`

**请求头**：
```
Authorization: Bearer {{STUDENT_TOKEN}}
```

**请求体**：
```json
{
  "verificationCode": "班级验证码"
}
```

**预期结果**：
- 返回状态码：200
- 班级绑定成功
- 返回班级信息

---

### 3.3 查询学生班级列表

**接口**：`GET /api/student/classes`

**预期结果**：
- 返回学生已绑定的所有班级
- 包含班级名称、班级编号、绑定时间、学生人数

---

### 3.4 查询签到记录

**接口**：`GET /api/student/attendance/records`

**查询参数**（可选）：
- `courseId`: 课程ID

**预期结果**：
- 返回学生的所有签到记录
- 包含签到时间、签到状态、课程信息

---

### 3.5 查询签到统计

**接口**：`GET /api/student/attendance/stats`

**预期结果**：
- 返回签到统计数据
- 包含总次数、出勤、缺勤、迟到、请假次数

---

### 3.6 上传作业文件

**接口**：`POST /api/student/assignments/upload`

**请求类型**：`multipart/form-data`

**请求参数**：
- `courseId`: 课程ID（如：CS101）
- `experimentId`: 实验ID（如：EXP001）
- `submissionType`: 提交类型（如：实验报告）
- `file`: 作业文件（PDF、Word、ZIP等）

**预期结果**：
- 返回状态码：200
- 文件上传成功
- 返回作业信息（初始状态为 draft）

---

### 3.7 提交作业

**接口**：`POST /api/student/assignments/{submissionId}/submit`

**路径参数**：
- `submissionId`: 作业ID

**预期结果**：
- 返回状态码：200
- 作业状态从 "draft" 更新为 "submitted"
- 记录提交时间

---

### 3.8 查询作业列表

**接口**：`GET /api/student/assignments`

**查询参数**（可选）：
- `courseId`: 课程ID
- `experimentId`: 实验ID

**预期结果**：
- 返回学生的所有作业
- 包含文件信息、提交状态、分数（已批改）、评语

---

### 3.9 删除作业（仅草稿状态）

**接口**：`DELETE /api/student/assignments/{submissionId}`

**路径参数**：
- `submissionId`: 作业ID

**预期结果**：
- 返回状态码：200
- 仅当状态为 "draft" 时可删除
- 物理文件和数据库记录均被删除

---

### 3.10 查询成绩

**接口**：`GET /api/student/grades`

**查询参数**（可选）：
- `semester`: 学期

**预期结果**：
- 返回学生的所有课程成绩
- 包含课程名称、成绩、评语、审核状态

---

## 四、微信功能测试（可选）

### 4.1 获取微信绑定状态

**接口**：`GET /api/wechat/bind-status`

**预期结果**：
- 返回微信绑定状态
- 是否已绑定、微信昵称、绑定时间等

---

### 4.2 绑定微信账号

**接口**：`POST /api/wechat/bind`

**请求参数**：
- `code`: 微信授权 code（从微信授权接口获取）

**预期结果**：
- 返回状态码：200
- 微信账号绑定成功
- 保存 OpenID、UnionID、昵称、头像

---

### 4.3 微信授权登录

**接口**：`POST /api/wechat/login`

**请求参数**：
- `code`: 微信授权 code

**预期结果**：
- 返回状态码：200
- 返回 JWT Token
- 返回用户信息

---

### 4.4 解绑微信账号

**接口**：`POST /api/wechat/unbind`

**预期结果**：
- 返回状态码：200
- 清除微信绑定信息

---

## 五、数据导入导出扩展测试

### 5.1 获取用户导入模板

**接口**：`GET /api/test/excel/template/users`

**预期结果**：
- 下载 users.xlsx 模板文件
- 包含示例数据和字段说明

---

## 六、异常场景测试

### 6.1 认证异常

#### 6.1.1 未登录访问受保护接口
- **步骤**：不携带 Token 访问需要认证的接口
- **预期结果**：返回 401 错误

#### 6.1.2 Token 过期
- **步骤**：使用过期的 Token 访问接口
- **预期结果**：返回 401 错误

#### 6.1.3 权限不足
- **步骤**：学生 Token 访问教师接口
- **预期结果**：返回 403 错误

---

### 6.2 业务异常

#### 6.2.1 重复绑定班级
- **步骤**：学生重复绑定同一班级
- **预期结果**：返回 400 错误，提示"已绑定该班级"

#### 6.2.2 提交不存在的作业
- **步骤**：提交不存在的作业ID
- **预期结果**：返回 404 错误

#### 6.2.3 删除已提交的作业
- **步骤**：删除状态为 "submitted" 的作业
- **预期结果**：返回 400 错误，提示"只能删除草稿状态的作业"

#### 6.2.4 文件大小超限
- **步骤**：上传超过 50MB 的作业文件
- **预期结果**：返回 400 错误，提示"文件大小不能超过50MB"

#### 6.2.5 文件格式错误
- **步骤**：上传非允许格式的文件（如 .exe）
- **预期结果**：返回 400 错误，提示"不支持的文件格式"

---

## 七、性能测试建议

### 7.1 并发测试
- 多个学生同时签到
- 批量导入大量用户数据（1000+）
- 多个教师同时导出成绩

### 7.2 压力测试
- 文件上传上限测试（50MB）
- 大量数据导出测试（10000+ 记录）

---

## 八、测试检查清单

### 8.1 用户管理
- [ ] 管理员登录成功
- [ ] 批量导入用户成功
- [ ] 教师登录成功
- [ ] 学生登录成功

### 8.2 班级管理
- [ ] 学生成功绑定班级
- [ ] 查询班级列表成功
- [ ] 教师查询班级学生成功

### 8.3 签到功能
- [ ] 学生签到成功
- [ ] 查询签到记录成功
- [ ] 查询签到统计成功
- [ ] 教师查询跨班签到学生成功

### 8.4 作业管理
- [ ] 学生上传作业成功
- [ ] 学生提交作业成功
- [ ] 查询作业列表成功
- [ ] 教师批改作业成功
- [ ] 删除草稿作业成功
- [ ] 无法删除已提交作业

### 8.5 成绩管理
- [ ] 教师创建成绩成功
- [ ] 学生查询成绩成功
- [ ] 教师审核成绩成功
- [ ] 导出成绩Excel成功

### 8.6 数据导入导出
- [ ] 导出考勤记录Excel成功
- [ ] 下载导入模板成功

### 8.7 微信功能（可选）
- [ ] 微信绑定成功
- [ ] 微信登录成功
- [ ] 微信解绑成功

### 8.8 异常处理
- [ ] 未登录访问受保护接口返回401
- [ ] 权限不足返回403
- [ ] 资源不存在返回404
- [ ] 业务异常返回400
- [ ] 服务器异常返回500

---

## 九、测试数据清理

测试完成后，如需清理数据：

```sql
-- 清理测试数据（谨慎操作）
DELETE FROM assignment_submissions WHERE student_username LIKE '211250%';
DELETE FROM course_grades WHERE student_username LIKE '211250%';
DELETE FROM attendance_records WHERE student_username LIKE '211250%';
DELETE FROM student_class_relations WHERE student_username LIKE '211250%';
DELETE FROM users WHERE username LIKE '211250%' OR username LIKE '00006%';
DELETE FROM classes WHERE class_code LIKE '工程实践%';
```

---

## 十、注意事项

1. **执行顺序**：严格按照上述顺序执行测试，确保数据依赖关系正确
2. **Token 管理**：每次登录后及时更新环境变量中的 Token
3. **文件上传**：确保上传的文件符合大小和格式要求
4. **数据清理**：测试完成后及时清理测试数据，避免污染生产环境
5. **日志查看**：遇到错误时查看控制台日志，定位问题根源
6. **数据库状态**：测试过程中可随时查询数据库，验证数据正确性

---

## 附录：Postman 环境变量示例

```json
{
  "baseUrl": "http://localhost:8080",
  "ADMIN_TOKEN": "",
  "TEACHER_TOKEN": "",
  "STUDENT_TOKEN": "",
  "courseId": "CS101",
  "experimentId": "EXP001",
  "studentUsername": "2112503179",
  "teacherUsername": "00006140",
  "classCode": "工程实践B01"
}
```

---

**文档版本**：v1.0
**最后更新**：2025-01-26
**维护人员**：系统开发团队
